generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

type EntityMetadata {
  name        String
  description String
  discord     String?
  logo        String?
  telegram    String?
  website     String?
  x           String?
}

type AvsOperator {
  address  String
  isActive Boolean
}

model Avs {
  id              String          @id @default(auto()) @map("_id") @db.ObjectId
  address         String          @unique
  metadata        EntityMetadata
  curatedMetadata EntityMetadata?
  tags            String[]

  isVisible  Boolean       @default(false)
  isVerified Boolean       @default(false)
  operators  AvsOperator[]

  // blockNumber BigInt
  // createdAt   DateTime
  // updatedAt   DateTime

  @@index([tags], map: "tags_1")
}

type StrategyShares {
  shares   String
  strategy String
}

type OperatorStaker {
  address String
  shares  StrategyShares[]
}

model Operator {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  address String @unique

  metadata        EntityMetadata
  curatedMetadata EntityMetadata?
  shares          StrategyShares[]
  // stakers         OperatorStaker[]
  // totalStakers    Int              @default(0)

  // blockNumber BigInt
  // createdAt   DateTime
  // updatedAt   DateTime
}

model Staker {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  address String @unique

  delegatedTo String?
  shares      StrategyShares[]
}

model Pod {
  id          String @id @default(auto()) @map("_id") @db.ObjectId
  address     String @unique
  owner       String
  blockNumber BigInt
}

model ValidatorRestake {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  podAddress     String
  validatorIndex BigInt
  blockNumber    BigInt
}

model Validator {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  validatorIndex BigInt
  status         String

  balance               BigInt
  effectiveBalance      BigInt
  slashed               Boolean
  withdrawalCredentials String
}

// Collection to store system settings
model Settings {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  key       String   @unique
  value     Json     @db.Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ======================================

model strategies {
  id String @id @default(auto()) @map("_id") @db.ObjectId
}
